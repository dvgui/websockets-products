(()=>{"use strict";var t={500:function(t,e,r){var s=this&&this.__awaiter||function(t,e,r,s){return new(r||(r=Promise))((function(o,n){function i(t){try{u(s.next(t))}catch(t){n(t)}}function c(t){try{u(s.throw(t))}catch(t){n(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,c)}u((s=s.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=o(r(147)),i=(t,e)=>s(void 0,void 0,void 0,(function*(){try{return yield n.default.promises.writeFile(t,e)}catch(t){console.log("Error de escritura "+t)}}));e.default=class{constructor(t){this.path=t,this.id=0,this.content=[];try{(t=>s(void 0,void 0,void 0,(function*(){try{return yield n.default.promises.readFile(t,"utf-8")}catch(t){throw new Error("Error de lectura "+t)}})))(this.path).then((t=>{this.content=JSON.parse(t)})),this.content.forEach((t=>{t.id>=this.id&&(this.id=t.id+1)}))}catch(t){throw(()=>{s(this,void 0,void 0,(function*(){return yield i(this.path,"[]")}))})(),new Error("Error "+t)}}save(t){return t.id=this.id,this.content.push(t),this.id++,i(this.path,JSON.stringify(this.content)).catch((t=>{console.log("Error al escribir",t)})),this.id-1}getAll(){return this.content}deleteById(t){this.content=this.content.filter((e=>e.id!==Number(t))),i(this.path,JSON.stringify(this.content)).catch((t=>{console.log("Error al escribir",t)}))}deleteAll(){this.content=[]}update(t,e){if(!this.getById(t))return null;let r=Object.assign(Object.assign({},e),{id:t});return this.deleteById(t),this.content.push(r),i(this.path,JSON.stringify(this.content)).catch((t=>{console.log("Error al escribir",t)})),r}getById(t){return this.content.find((e=>e.id===Number(t)))||null}}},232:function(t,e,r){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=s(r(500));e.default=class{constructor(t){this.products=new o.default(t)}getAll(){return this.products.getAll()}push(t){let e=this.products.save(t);return this.products.getById(e)}update(t,e){return this.products.update(t,e)}delete(t){let e=this.products.getById(t);return this.products.deleteById(t),e}get(t){return this.products.getById(t)}}},607:function(t,e,r){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=s(r(860)),n=r(685),i=r(952),c=s(r(232)),u=process.env.PORT||3e3,d=(0,o.default)(),l=new c.default("./data/products.json"),a=new c.default("./data/messages.json"),h=(0,n.createServer)(d),p=new i.Server(h,{path:"/socket.io"});d.use(o.default.urlencoded({extended:!0})),d.set("views","./public"),d.set("view engine","ejs"),d.use(o.default.static("public")),d.get("/",((t,e)=>{e.render("index",{messages:a})})),p.on("connection",(t=>{console.log("Un cliente se ha conectado"),t.emit("messages",a.getAll()),t.emit("products",l.getAll()),t.on("new-message",(function(t){a.push(t),p.sockets.emit("messages",a.getAll())})),t.on("new-product",(t=>{l.push(t),p.sockets.emit("products",l.getAll())}))})),h.listen(u,(()=>{const t=h.address(),e="string"==typeof t?`pipe/socket ${t}`:`port ${null==t?void 0:t.port}`;console.log(`Servidor Http con Websockets escuchando en el puerto ${e}`)})).on("error",(t=>console.log(`Error en servidor ${t}`)))},860:t=>{t.exports=require("express")},952:t=>{t.exports=require("socket.io")},147:t=>{t.exports=require("fs")},685:t=>{t.exports=require("http")}},e={};!function r(s){var o=e[s];if(void 0!==o)return o.exports;var n=e[s]={exports:{}};return t[s].call(n.exports,n,n.exports,r),n.exports}(607)})();